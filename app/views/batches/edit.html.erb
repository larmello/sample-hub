<div class="container my-4">
  <h2>Remessa 
    <%= @batch.sender.institution %> 
    código <%= @batch.id %> 
    (<%= pluralize(@samples.count, 'amostra', plural: 'amostras') %>)
  </h2>

  <p>Situação: <%= @status %></p>

  <%# INI BATCH EDIT SECTION %>
  <div>
    <%= simple_form_for(@batch) do |f| %>
      <%# sender can edit sent date if batch has not been sent yet %>
      <% if @batch.sent_at.nil? && sender?(current_user) %>
        <%= f.input :sent_at, label: "Data de envio" %>
        <%= f.submit %>
      <% end %>
      <%# receiver can edit received date after batch is sent %>
      <% if @batch.sent_at && @batch.received_at.nil? && receiver?(current_user) %>
        <%= f.input :received_at, label: "Data de recebimento" %>
        <%= f.submit %>
      <% end %>
      <%# if batch is sent, everyone can view the sent date %>
      <% if @batch.sent_at %>
        <p>Enviada em <%= date_mask(@batch.sent_at) %></p>
      <% end %>
      <%# if batch is received, everyone can view the delivery date %>
      <% if @batch.received_at %>
        <p>Recebida em <%= date_mask(@batch.received_at) %></p>
      <% end %>
    <% end %>
  </div>
  <%# END BATCH EDIT SECTION %>

  <%# INI SAMPLES TABLE %>
  <div class="card">
    <table class="table table-hover align-bottom">
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Nome</th>
          <th scope="col">Tipo</th>
          <th scope="col">Coletada em</th>
          <th scope="col">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% @samples.each do |sample| %>
          <tr>
            <th scope="row"><%= sample.id %></th>
            <td><%= "#{sample.patient.first_name} #{sample.patient.last_name}" %></td>

            <%# TIPO DE PACIENTE %>
            <% if Family.where(receptor: sample.patient).count > 0 %>
              <td>Receptor</td>
            <% elsif Family.where(donor: sample.patient).count > 0 %>
              <td>Doador</td>
            <% else %>
              <td>Não aparentado</td>
            <% end %>

            <%# DATA DA COLETA (SHOULD BE ABLE TO EDIT IN THIS VIEW) %>
            <td><%= date_mask(sample.collected_at) %></td>

            <%# INI ACTION LINKS %>
            <td>
              <% if sender?(current_user) && @batch.sent_at.nil? %>
                <%= link_to icon('fas','edit'), edit_sample_path(sample), :title => "editar" %>
                <%= link_to icon('fas','minus-circle'), edit_sample_path(sample), :title => "remover da remessa" %>
              <% else %>
                <%= link_to icon('far','eye'), sample_path(sample), :title => "ver amostra" %>
              <% end %>
            </td>
            <%# END ACTION LINKS %>

          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <%# END SAMPLES TABLE %>
</div>
