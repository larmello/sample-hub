<div class="container my-4">
  <h2>Remessa 
    <%= @batch.sender.institution %> 
    código <%= @batch.id %>
  </h2>

  <p>Situação: <%= @status %></p>

  <%# INI BATCH EDIT SECTION %>
  <div style="display: grid; width: 400px; ">
    <%# if batch is sent, everyone can view the sent date %>
    <% if @batch.sent_at %>
      <p>Enviada em <%= date_mask(@batch.sent_at) %></p>
    <%# sender can edit sent date if batch has not been sent yet %>
    <% elsif sender?(current_user) %>
      <%= simple_form_for(@batch) do |f| %>
        <%= f.input :sent_at, label: "Data do envio", as: :string, required: false, input_html: {class: "datepicker"} %>
        <%= f.button :submit, "enviar remessa", class: "btn btn-primary" %>
      <% end %>
    <% end %>

    <%# if batch is received, everyone can view the delivery date %>
    <% if @batch.received_at %>
      <p>Recebida em <%= date_mask(@batch.received_at) %></p>
    <%# receiver can edit received date after batch is sent %>
    <% elsif receiver?(current_user) && @batch.sent_at %>
      <%= simple_form_for(@batch) do |f| %>
        <%= f.input :received_at, label: "Data do recebimento", as: :string, required: false, input_html: {class: "datepicker"}  %>
        <%= f.button :submit, "confirmar recebimento", class: "btn btn-primary" %>
      <% end %>
    <% end %>
  </div>
  <%# END BATCH EDIT SECTION %>

  <% if sender?(current_user) && @batch.sent_at.nil? %>
    <div class="my-2">
      <%= link_to 'adicionar mais amostras', samples_path, class: "btn btn-primary" %>
    </div>
  <% end %>

  <%# INI SAMPLES TABLE %>
  <table class="caption-top"">
    <caption><%= pluralize(@samples.count, 'amostra', plural: 'amostras') %></caption>
    <table class="table table-hover align-bottom">
      <thead  style="background-color: gray; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); color: white;">
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Nome</th>
          <th scope="col">Tipo</th>
          <th scope="col" style="text-align: center;">Coletada em</th>
          <th scope="col" style="text-align: center;">Ações</th>
        </tr>
      </thead>
      <tbody style="background-color: white;">
        <% @samples.each do |sample| %>
          <tr>
            <th scope="row"><%= sample.id %></th>
            <td><%= "#{sample.patient.first_name} #{sample.patient.last_name}" %></td>

            <%# TIPO DE PACIENTE %>
            <% if Family.where(receptor: sample.patient).count > 0 %>
              <td>Receptor</td>
            <% elsif Family.where(donor: sample.patient).count > 0 %>
              <td>Doador</td>
            <% else %>
              <td>Não aparentado</td>
            <% end %>

            <%# COLETADA EM (SHOULD BE ABLE TO EDIT IN THIS VIEW) %>
            <td style="text-align: center;"><%= date_mask(sample.collected_at) %></td>

            <%# INI ACTION LINKS %>
            <td style="text-align: center;">
              <% if sender?(current_user) && @batch.sent_at.nil? %>
                <%= link_to icon('fas','edit'), edit_sample_path(sample), :title => "editar" %>
                <%= link_to icon('fas','minus-circle'), edit_sample_path(sample), :title => "remover da remessa" %>
              <% else %>
                <%= link_to icon('far','eye'), edit_sample_path(sample), :title => "ver amostra" %>
              <% end %>
            </td>
            <%# END ACTION LINKS %>

          </tr>
        <% end %>
      </tbody>
    </table>
  </table>
  <%# END SAMPLES TABLE %>
</div>
